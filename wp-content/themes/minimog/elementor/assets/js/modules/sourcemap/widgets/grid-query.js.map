{"version":3,"file":"../../../widgets/grid-query.js","sources":["widgets/grid-query.js"],"sourcesContent":["(\n\tfunction( $ ) {\n\t\t'use strict';\n\n\t\t$.fn.MinimogGridQuery = function() {\n\t\t\tvar $el, $grid;\n\t\t\tvar isQuerying = false;\n\t\t\tvar $queryInput;\n\n\t\t\t/**\n\t\t\t * Use small loader under of the grid instead of whole grid for pagination infinite scroll + load more button.\n\t\t\t */\n\t\t\tvar infiniteLoader = false;\n\n\t\t\tfunction initFilterCount() {\n\t\t\t\tif ( ! $el.children( '.minimog-grid-filter' ).data( 'filter-counter' ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$el.find( '.btn-filter' ).each( function() {\n\t\t\t\t\tvar count = $( this ).data( 'filter-count' );\n\n\t\t\t\t\tif ( $( this ).children( '.filter-counter' ).length > 0 ) {\n\t\t\t\t\t\t$( this ).children( '.filter-counter' ).text( count );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$( this ).append( '<span class=\"filter-counter\">' + count + '</span>' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tfunction handlerFilter() {\n\t\t\t\t$el.children( '.minimog-grid-filter' ).on( 'click', '.btn-filter', function( e ) {\n\t\t\t\t\tif ( $( this ).hasClass( 'current' ) ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( '1' != $el.data( 'query-main' ) ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $self = $( this );\n\n\t\t\t\t\tvar filterValue = $self.attr( 'data-filter' );\n\n\t\t\t\t\tif ( '*' === filterValue ) {\n\t\t\t\t\t\tsetQueryVars( 'extra_tax_query', '' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetQueryVars( 'extra_tax_query', filterValue );\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.trigger( 'MinimogBeginQuery' );\n\n\t\t\t\t\t$self.siblings().removeClass( 'current' );\n\t\t\t\t\t$self.addClass( 'current' );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tfunction handlerPagination() {\n\t\t\t\t// Do nothing if in elementor editor mode.\n\t\t\t\tif ( $( 'body' ).hasClass( 'elementor-editor-active' ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( $el.data( 'pagination' ) === 'load-more' ) {\n\t\t\t\t\t$el.children( '.minimog-grid-pagination' )\n\t\t\t\t\t   .find( '.minimog-load-more-button' )\n\t\t\t\t\t   .on( 'click', function( e ) {\n\t\t\t\t\t\t   e.preventDefault();\n\n\t\t\t\t\t\t   if ( ! isQuerying ) {\n\t\t\t\t\t\t\t   $( this ).hide();\n\n\t\t\t\t\t\t\t   var paged = getQueryVars( 'paged' );\n\t\t\t\t\t\t\t   paged ++;\n\n\t\t\t\t\t\t\t   setQueryVars( 'paged', paged );\n\t\t\t\t\t\t\t   infiniteLoader = true;\n\t\t\t\t\t\t\t   handlerQuery();\n\t\t\t\t\t\t   }\n\t\t\t\t\t   } );\n\t\t\t\t} else if ( $el.data( 'pagination' ) === 'load-more-alt' ) {\n\t\t\t\t\tvar loadMoreBtn = $( $el.data( 'pagination-custom-button-id' ) );\n\n\t\t\t\t\tloadMoreBtn.on( 'click', function( e ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif ( ! isQuerying ) {\n\t\t\t\t\t\t\t$( this ).hide();\n\n\t\t\t\t\t\t\tvar paged = getQueryVars( 'paged' );\n\t\t\t\t\t\t\tpaged ++;\n\n\t\t\t\t\t\t\tsetQueryVars( 'paged', paged );\n\t\t\t\t\t\t\tinfiniteLoader = true;\n\t\t\t\t\t\t\thandlerQuery();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} else if ( $el.data( 'pagination' ) === 'infinite' ) {\n\t\t\t\t\t// Waiting for header offset top & grid layout rendered.\n\t\t\t\t\tvar infiniteReady = setInterval( function() {\n\t\t\t\t\t\tif ( $grid.hasClass( 'loaded' ) ) {\n\t\t\t\t\t\t\thandlerScrollInfinite();\n\t\t\t\t\t\t\tclearInterval( infiniteReady );\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 200 );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handlerScrollInfinite() {\n\t\t\t\tvar windowHeight = $( window ).height();\n\t\t\t\t// 90% window height.\n\t\t\t\tvar halfWH = 90 / 100 * windowHeight;\n\t\t\t\thalfWH = parseInt( halfWH );\n\n\t\t\t\tvar elOffsetTop = $el.offset().top;\n\t\t\t\tvar elHeight = $el.outerHeight( true );\n\t\t\t\tvar offsetTop = elOffsetTop + elHeight;\n\t\t\t\tvar finalOffset = offsetTop - halfWH;\n\t\t\t\tvar oldST = 0;\n\n\t\t\t\t// On scroll.\n\t\t\t\t$( window ).scroll( function() {\n\t\t\t\t\tvar st = $( this ).scrollTop();\n\t\t\t\t\t// Scroll down & in view.\n\t\t\t\t\tif ( st > oldST && st >= finalOffset ) {\n\n\t\t\t\t\t\tif ( ! isQuerying ) {\n\t\t\t\t\t\t\tvar paged = getQueryVars( 'paged' );\n\t\t\t\t\t\t\tvar maxNumberPages = getQuery( 'max_num_pages' );\n\n\t\t\t\t\t\t\tif ( paged < maxNumberPages ) {\n\t\t\t\t\t\t\t\tpaged ++;\n\n\t\t\t\t\t\t\t\tsetQueryVars( 'paged', paged );\n\t\t\t\t\t\t\t\tinfiniteLoader = true;\n\t\t\t\t\t\t\t\thandlerQuery();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\toldST = st;\n\t\t\t\t} );\n\n\t\t\t\t$( window ).on( 'resize', function() {\n\t\t\t\t\t// Fix layout not really completed.\n\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\twindowHeight = $( window ).height();\n\t\t\t\t\t\t// 90% window height.\n\t\t\t\t\t\thalfWH = 90 / 100 * windowHeight;\n\t\t\t\t\t\thalfWH = parseInt( halfWH );\n\n\t\t\t\t\t\telOffsetTop = $el.offset().top;\n\t\t\t\t\t\telHeight = $el.outerHeight( true );\n\t\t\t\t\t\toffsetTop = elOffsetTop + elHeight;\n\t\t\t\t\t\tfinalOffset = offsetTop - halfWH;\n\t\t\t\t\t}, 100 );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Load post infinity from db.\n\t\t\t */\n\t\t\tfunction handlerQuery( reset ) {\n\t\t\t\tisQuerying = true;\n\n\t\t\t\tvar loader;\n\t\t\t\tif ( infiniteLoader === true ) {\n\t\t\t\t\tloader = $el.find( '.minimog-infinite-loader' );\n\t\t\t\t} else {\n\t\t\t\t\tloader = $grid.children( '.minimog-grid-loader' );\n\t\t\t\t}\n\n\t\t\t\tloader.addClass( 'show' );\n\n\t\t\t\tsetTimeout( function() {\n\t\t\t\t\tvar query = jQuery.parseJSON( $queryInput.val() );\n\t\t\t\t\tvar _data = $.param( query );\n\n\t\t\t\t\t$.ajax( {\n\t\t\t\t\t\turl: $minimog.ajaxurl,\n\t\t\t\t\t\ttype: 'GET',\n\t\t\t\t\t\tdata: _data,\n\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\tsuccess: function( results ) {\n\t\t\t\t\t\t\tif ( results.max_num_pages ) {\n\t\t\t\t\t\t\t\tsetQuery( 'max_num_pages', results.max_num_pages );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( results.found_posts ) {\n\t\t\t\t\t\t\t\tsetQuery( 'found_posts', results.found_posts );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( results.count ) {\n\t\t\t\t\t\t\t\tsetQuery( 'count', results.count );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar html = results.template;\n\t\t\t\t\t\t\tvar $newItems = $( $.parseHTML( html ) );\n\n\t\t\t\t\t\t\tif ( reset === true ) {\n\t\t\t\t\t\t\t\t$grid.children( '.grid-item' ).remove();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$el.trigger( 'MinimogQueryEnd', [ $el, $newItems ] );\n\n\t\t\t\t\t\t\tupdateResultCount();\n\n\t\t\t\t\t\t\thandlerQueryEnd();\n\n\t\t\t\t\t\t\tloader.removeClass( 'show' );\n\n\t\t\t\t\t\t\tisQuerying = false;\n\t\t\t\t\t\t\tinfiniteLoader = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}, 500 );\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Remove pagination if has no posts anymore\n\t\t\t */\n\t\t\tfunction handlerQueryEnd() {\n\t\t\t\tvar foundPosts = getQuery( 'found_posts' );\n\t\t\t\tvar paged = getQueryVars( 'paged' );\n\t\t\t\tvar numberPages = getQueryVars( 'posts_per_page' );\n\n\t\t\t\tif ( foundPosts <= (\n\t\t\t\t\tpaged * numberPages\n\t\t\t\t) ) {\n\t\t\t\t\tif ( $el.data( 'pagination' ) === 'load-more-alt' ) {\n\t\t\t\t\t\tvar loadMoreBtn = $( $el.data( 'pagination-custom-button-id' ) );\n\n\t\t\t\t\t\tloadMoreBtn.hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$el.children( '.minimog-grid-pagination' ).children( '.pagination-wrapper' ).hide();\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.children( '.minimog-grid-pagination' ).children( '.minimog-grid-messages' ).show();\n\t\t\t\t} else {\n\t\t\t\t\tif ( $el.data( 'pagination' ) === 'load-more-alt' ) {\n\t\t\t\t\t\tvar loadMoreBtn = $( $el.data( 'pagination-custom-button-id' ) );\n\n\t\t\t\t\t\tloadMoreBtn.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$el.children( '.minimog-grid-pagination' ).children( '.pagination-wrapper' ).show();\n\t\t\t\t\t\t$el.children( '.minimog-grid-pagination' ).find( '.minimog-load-more-button' ).show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction updateResultCount() {\n\t\t\t\tvar resultCount = $el.find( '.result-count' ).first();\n\t\t\t\tif ( resultCount.length > 0 ) {\n\t\t\t\t\tvar count = getQuery( 'found_posts' );\n\t\t\t\t\tresultCount.find( '.count' ).text( count );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getQuery( name ) {\n\t\t\t\tvar query = jQuery.parseJSON( $queryInput.val() );\n\n\t\t\t\treturn query[ name ];\n\t\t\t}\n\n\t\t\tfunction setQuery( name, newValue ) {\n\t\t\t\tvar query = jQuery.parseJSON( $queryInput.val() );\n\n\t\t\t\tquery[ name ] = newValue;\n\n\t\t\t\t$queryInput.val( JSON.stringify( query ) );\n\t\t\t}\n\n\t\t\tfunction getQueryVars( name ) {\n\t\t\t\tvar queryVars = jQuery.parseJSON( $queryInput.val() );\n\n\t\t\t\treturn queryVars.query_vars[ name ];\n\t\t\t}\n\n\t\t\tfunction setQueryVars( name, newValue ) {\n\t\t\t\tvar queryVars = jQuery.parseJSON( $queryInput.val() );\n\n\t\t\t\tqueryVars.query_vars[ name ] = newValue;\n\n\t\t\t\t$queryInput.val( JSON.stringify( queryVars ) );\n\t\t\t}\n\n\t\t\treturn this.each( function() {\n\t\t\t\t$el = $( this );\n\t\t\t\t$grid = $el.find( '.minimog-grid' );\n\t\t\t\t$queryInput = $el.find( '.minimog-query-input' ).first();\n\n\t\t\t\tinitFilterCount();\n\t\t\t\thandlerFilter();\n\t\t\t\thandlerPagination();\n\n\t\t\t\t$el.on( 'MinimogBeginQuery', function() {\n\t\t\t\t\t// Reset to first page.\n\t\t\t\t\tsetQueryVars( 'paged', 1 );\n\t\t\t\t\thandlerQuery( true );\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\t}( jQuery )\n);\n"],"names":["$","fn","MinimogGridQuery","$el","$grid","$queryInput","isQuerying","infiniteLoader","handlerPagination","infiniteReady","hasClass","data","children","find","on","e","preventDefault","this","hide","paged","getQueryVars","setQueryVars","handlerQuery","setInterval","windowHeight","halfWH","window","height","parseInt","elOffsetTop","offset","top","elHeight","outerHeight","finalOffset","oldST","scroll","st","scrollTop","getQuery","setTimeout","handlerScrollInfinite","clearInterval","reset","loader","addClass","query","jQuery","parseJSON","val","_data","param","ajax","url","$minimog","ajaxurl","type","dataType","success","results","max_num_pages","setQuery","found_posts","count","html","template","$newItems","parseHTML","remove","trigger","resultCount","first","length","text","updateResultCount","foundPosts","numberPages","show","removeClass","name","newValue","JSON","stringify","query_vars","queryVars","each","append","$self","filterValue","attr","siblings"],"mappings":"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"}