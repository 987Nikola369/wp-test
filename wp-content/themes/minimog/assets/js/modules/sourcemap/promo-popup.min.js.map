{"version":3,"sources":["promo-popup.js"],"names":["$","pageViews","clickTimes","lastST","Helpers","window","minimog","Storage","$window","shouldOpen","rules","$minimogPopup","$promoPopup","addClickHandler","onClick","document","body","trigger","addScrollingHandler","currentST","this","scrollTop","direction","docHeight","height","winHeight","offset","Math","round","onScrolling","isSupported","get","set","byTimes","enable","times","byPageViews","reach","onLoad","on","delay","setTimeout","evt","off","preventDefault","$button","copyToClipboard","siblings","val","text","data","popupTimes","one","MinimogModal","jQuery"],"mappings":"AAEA,CAAA,SAAAA,GACA,aAEA,IAQAC,EAqCAC,EAUAC,EAvDAC,EAAAC,OAAAC,QAAAF,QACAG,EAAAF,OAAAC,QAAAC,QACAC,EAAAR,EAAAK,MAAA,EACAI,EAAA,CAAA,EACAC,EAAAC,cAAAD,MACAE,EAAAZ,EAAA,oBAAA,EAyEA,SAAAa,IACAX,EAAAA,GACAS,cAAAG,QAAAZ,YACAF,EAAAe,SAAAC,IAAA,EAAAC,QAAA,uBAAA,CAEA,CAEA,SAAAC,IACA,IAAAC,EAAAnB,EAAAoB,IAAA,EAAAC,UAAA,EACAC,EAAAnB,EAAAgB,EAAA,OAAA,KACAI,EAAAvB,EAAAe,QAAA,EAAAS,OAAA,EACAC,EAAAzB,EAAAK,MAAA,EAAAmB,OAAA,EAEAE,EAAAC,KAAAC,MAAA,KADA,GAAAL,EAAAE,GACA,EAEAC,EAAA,MAAAJ,EAAA,IAAAI,EAAAA,EAEAJ,IAAAX,cAAAkB,YAAAP,WAAAI,GAAAf,cAAAkB,YAAAH,QACA1B,EAAAe,SAAAC,IAAA,EAAAC,QAAA,uBAAA,EAGAd,EAAAgB,CACA,CA7FAZ,EAAAuB,cACA7B,EAAAM,EAAAwB,IAAA,YAAA,CAAA,EACAxB,EAAAyB,IAAA,YAAA,EAAA/B,CAAA,GAGA,MAAAS,EAAAuB,QAAAC,QACA3B,EAAAwB,IAAA,aAAA,CAAA,GAEArB,EAAAuB,QAAAE,QACA1B,EAAA,CAAA,IAQAA,EAJA,MAAAC,EAAA0B,YAAAF,QACA3B,EAAAwB,IAAA,YAAA,CAAA,GAEArB,EAAA0B,YAAAC,MACA,CAAA,EAIA5B,KAIA,MAAAE,cAAA2B,OAAAJ,QACA1B,EAAA+B,GAAA,OAAA,WACA,EAAA5B,cAAA2B,OAAAE,MACAC,WAAA,WACAzC,EAAAe,SAAAC,IAAA,EAAAC,QAAA,uBAAA,CACA,EAAA,IAAAN,cAAA2B,OAAAE,KAAA,EAEAxC,EAAAe,SAAAC,IAAA,EAAAC,QAAA,uBAAA,CAEA,CAAA,EAGA,MAAAN,cAAAG,QAAAoB,SACAhC,EAAA,EAEAF,EAAAe,QAAA,EAAAwB,GAAA,QAAA1B,CAAA,EAEAD,EAAA2B,GAAA,mBAAA,SAAAG,GACA1C,EAAAe,QAAA,EAAA4B,IAAA,QAAA9B,CAAA,CACA,CAAA,GAGA,MAAAF,cAAAkB,YAAAK,SACA/B,EAAA,EAEAK,EAAA+B,GAAA,SAAArB,CAAA,EAEAN,EAAA2B,GAAA,mBAAA,WACA/B,EAAAmC,IAAA,SAAAzB,CAAA,CACA,CAAA,GAGAN,EAAA2B,GAAA,QAAA,YAsCA,SAAAG,GACAA,EAAAE,eAAA,EACAC,EAAA7C,EAAAoB,IAAA,EACAhB,EAAA0C,gBAAAD,EAAAE,SAAA,OAAA,EAAAC,IAAA,CAAA,GAGAH,EAAAI,KAAAJ,EAAAK,KAAA,iBAAA,CAAA,CAEA,CA9CA,EAEAtC,EAAA2B,GAAA,oBAAA,WAMA,IACAY,EANAvC,EAAA+B,IAAA,QAAA,YAAA9B,EAAA,CAAA,EAKAN,EAAAuB,cACAqB,EAAA5C,EAAAwB,IAAA,aAAA,CAAA,EACAxB,EAAAyB,IAAA,aAAA,EAAAmB,CAAA,EALA,CAAA,EA2CAnD,EAAAe,SAAAC,IAAA,EAAAoC,IAAA,wBAAA,WACAxC,EAAAyC,aAAA,MAAA,CACA,CAAA,EACA,EAAAC,MAAA","file":"../../promo-popup.min.js","sourcesContent":["/* global $minimog */\n/* global $minimogPopup */\n(function( $ ) {\n\t'use strict';\n\n\tvar Helpers     = window.minimog.Helpers,\n\t    Storage     = window.minimog.Storage,\n\t    $window     = $( window ),\n\t    shouldOpen  = true,\n\t    rules       = $minimogPopup.rules,\n\t    $promoPopup = $( '#modal-promo-popup' );\n\n\tif ( Storage.isSupported ) {\n\t\tvar pageViews = Storage.get( 'pageViews', 0 );\n\t\tStorage.set( 'pageViews', ++ pageViews );\n\t}\n\n\tif ( '1' === rules.byTimes.enable ) {\n\t\tvar popupTimes = Storage.get( 'popupTimes', 0 );\n\n\t\tif ( popupTimes >= rules.byTimes.times ) {\n\t\t\tshouldOpen = false;\n\t\t}\n\t}\n\n\tif ( '1' === rules.byPageViews.enable ) {\n\t\tvar viewed = Storage.get( 'pageViews', 0 );\n\n\t\tif ( viewed <= rules.byPageViews.reach ) {\n\t\t\tshouldOpen = false;\n\t\t}\n\t}\n\n\tif ( ! shouldOpen ) {\n\t\treturn;\n\t}\n\n\tif ( '1' === $minimogPopup.onLoad.enable ) {\n\t\t$window.on( 'load', function() {\n\t\t\tif ( $minimogPopup.onLoad.delay > 0 ) {\n\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t$( document.body ).trigger( 'MinimogPromoPopupOpen' );\n\t\t\t\t}, $minimogPopup.onLoad.delay * 1000 );\n\t\t\t} else {\n\t\t\t\t$( document.body ).trigger( 'MinimogPromoPopupOpen' );\n\t\t\t}\n\t\t} );\n\t}\n\n\tif ( '1' === $minimogPopup.onClick.enable ) {\n\t\tvar clickTimes = 0;\n\n\t\t$( document ).on( 'click', addClickHandler );\n\n\t\t$promoPopup.on( 'MinimogModalOpen', function( evt ) {\n\t\t\t$( document ).off( 'click', addClickHandler );\n\t\t} );\n\t}\n\n\tif ( '1' === $minimogPopup.onScrolling.enable ) {\n\t\tvar lastST = 0;\n\n\t\t$window.on( 'scroll', addScrollingHandler );\n\n\t\t$promoPopup.on( 'MinimogModalOpen', function() {\n\t\t\t$window.off( 'scroll', addScrollingHandler );\n\t\t} );\n\t}\n\n\t$promoPopup.on( 'click', '.btn-copy', addCopyHandler );\n\n\t$promoPopup.on( 'MinimogModalClose', function() {\n\t\t$promoPopup.off( 'click', '.btn-copy', addClickHandler() );\n\t\tupdatePopupState();\n\t} );\n\n\tfunction updatePopupState() {\n\t\tif ( Storage.isSupported ) {\n\t\t\tvar popupTimes = Storage.get( 'popupTimes', 0 );\n\t\t\tStorage.set( 'popupTimes', ++ popupTimes );\n\t\t}\n\t}\n\n\tfunction addClickHandler() {\n\t\tclickTimes ++;\n\t\tif ( clickTimes >= $minimogPopup.onClick.clickTimes ) {\n\t\t\t$( document.body ).trigger( 'MinimogPromoPopupOpen' );\n\t\t}\n\t}\n\n\tfunction addScrollingHandler() {\n\t\tvar currentST     = $( this ).scrollTop(),\n\t\t    direction     = currentST > lastST ? 'down' : 'up',\n\t\t    docHeight     = $( document ).height(),\n\t\t    winHeight     = $( window ).height(),\n\t\t    scrollPercent = (currentST) / (docHeight - winHeight),\n\t\t    offset        = Math.round( scrollPercent * 100 );\n\n\t\toffset = 'up' === direction ? 100 - offset : offset;\n\n\t\tif ( direction === $minimogPopup.onScrolling.direction && offset >= $minimogPopup.onScrolling.offset ) {\n\t\t\t$( document.body ).trigger( 'MinimogPromoPopupOpen' );\n\t\t}\n\n\t\tlastST = currentST;\n\t}\n\n\tfunction addCopyHandler( evt ) {\n\t\tevt.preventDefault();\n\t\tvar $button = $( this ),\n\t\t    result  = Helpers.copyToClipboard( $button.siblings( 'input' ).val() );\n\n\t\tif ( result ) {\n\t\t\t$button.text( $button.data( 'message-success' ) );\n\t\t}\n\t}\n\n\t$( document.body ).one( 'MinimogPromoPopupOpen', function() {\n\t\t$promoPopup.MinimogModal( 'open' );\n\t} );\n}( jQuery ));\n"]}